parameter bytes;storage (pair (map address mutez) (map address timestamp));code{DUP;CDR;NIL operation;PAIR;SWAP;CAR;DUP;PUSH nat 4;PUSH nat 0;SLICE;IF_NONE{PUSH nat 100;FAILWITH}{};DUP;PUSH bytes 0xdde2916a;COMPARE;EQ;IF{DROP;DROP;NONE mutez;NONE int;PAIR;NONE int;PAIR;NONE int;PAIR;PAIR;AMOUNT;DIP{PUSH mutez 1};EDIV;IF_NONE{PUSH string "Error with casting";FAILWITH}{};CAR;PUSH int 1;MUL;DIP{PUSH int 10};EDIV;IF_NONE{PUSH string "Divisible by 0";FAILWITH}{};CAR;SWAP;SET_CAAR;UNIT;DIP{DUP;CAAR;DUP;GT;IF{}{PUSH string "Mutez conversion not possible";FAILWITH};ABS;DIP{PUSH mutez 1};MUL};DIIP{SELF;ADDRESS;CONTRACT unit;IF_NONE{PUSH string "Invalid contract";FAILWITH}{}};TRANSFER_TOKENS;DIP{DUP;CDAR};CONS;SWAP;SET_CDAR;SENDER;DIP{DUP;CDDDR};MEM;DIP{PUSH bool True};COMPARE;NEQ;IF{SENDER;DIP{NOW;SOME};DIIP{DUP;CDDDR};UPDATE;SWAP;SET_CDDDR;SENDER;DIP{AMOUNT;SOME};DIIP{DUP;CDDAR};UPDATE;SWAP;SET_CDDAR;PUSH string "Successfully registered";FAILWITH}{};NOW;DIP{SENDER;DIP{DUP;CDDDR};GET;IF_NONE{PUSH string "Key not found in map";FAILWITH}{}};SUB;DIP{PUSH int 3600};EDIV;IF_NONE{PUSH string "Divisible by 0";FAILWITH}{};CAR;SWAP;SET_CADAR;DUP;CADAR;DIP{PUSH int 3600};COMPARE;LT;IF{PUSH string "Spent time is less than 1 hour";FAILWITH}{};DUP;CADAR;DIP{PUSH int 3600};EDIV;IF_NONE{PUSH string "Divisible by 0";FAILWITH}{};CAR;SWAP;SET_CADDAR;SENDER;DIP{DUP;CDDAR};GET;IF_NONE{PUSH string "Key not found in map";FAILWITH}{};DIP{PUSH int 0;DIP{DUP;CADDAR};EDIV;IF_NONE{PUSH string "Divisible by 0";FAILWITH}{};CDR};EDIV;IF_NONE{PUSH string "Divisible by 0";FAILWITH}{};CDR;SWAP;SET_CADDDR;BALANCE;DIP{DUP;CADDDR};COMPARE;LT;IF{PUSH string "Not enough money";FAILWITH}{};UNIT;DIP{DUP;CADDDR};DIIP{SENDER;CONTRACT unit;IF_NONE{PUSH string "Invalid contract";FAILWITH}{}};TRANSFER_TOKENS;DIP{DUP;CDAR};CONS;SWAP;SET_CDAR;SENDER;DIP{NOW;SOME};DIIP{DUP;CDDDR};UPDATE;SWAP;SET_CDDDR;SENDER;DIP{SENDER;DIP{DUP;CDDAR};GET;IF_NONE{PUSH string "Key not found in map";FAILWITH}{};DIP{AMOUNT};ADD;SOME};DIIP{DUP;CDDAR};UPDATE;SWAP;SET_CDDAR;CDR}{DROP;PUSH nat 400;FAILWITH}}
